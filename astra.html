<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTRA - Advanced Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff1b4d;
            --secondary: #00ebc7;
            --accent: #7700ff;
            --bg-dark: #0d0d17;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            color: var(--primary);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(119, 0, 255, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(255, 27, 77, 0.1) 0%, transparent 25%);
        }

        .hologram-container {
            position: relative;
            width: 80vmin;
            height: 80vmin;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hologram-circle {
            position: absolute;
            border-radius: 50%;
            border: 1px solid;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            mix-blend-mode: screen;
            /* Center the circles */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .circle-1 {
            width: 100%;
            height: 100%;
            border-color: var(--primary);
            animation: rotate 60s infinite, pulse-opacity 8s infinite;
            box-shadow: 0 0 30px rgba(255, 27, 77, 0.3);
        }

        .circle-2 {
            width: 80%;
            height: 80%;
            border-color: var(--secondary);
            animation: rotate-reverse 45s infinite, pulse-opacity 12s infinite 2s;
            box-shadow: 0 0 30px rgba(0, 235, 199, 0.3);
        }

        .circle-3 {
            width: 60%;
            height: 60%;
            border-color: var(--accent);
            animation: rotate 30s infinite, pulse-opacity 15s infinite 4s;
            box-shadow: 0 0 30px rgba(119, 0, 255, 0.3);
        }

        .hologram-core {
            position: relative;
            width: 40%;
            height: 40%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 27, 77, 0.2) 0%, transparent 70%);
            z-index: 10;
            transition: all 0.3s ease;
            /* Center the core */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .voice-active .hologram-core {
            background: radial-gradient(circle, rgba(255, 27, 77, 0.4) 0%, transparent 70%);
            box-shadow: 0 0 50px rgba(255, 27, 77, 0.2);
            transform: translate(-50%, -50%) scale(1.05);
        }

        /* Rest of your CSS remains the same */
        .interface-panel {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .status-container {
            position: absolute;
            top: 5%;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .status {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.7;
            background: rgba(13, 13, 23, 0.7);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 10px rgba(255, 27, 77, 0.3);
            transition: all 0.3s ease;
        }

        .controls-container {
            position: absolute;
            bottom: 5%;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .mic-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 20;
            opacity: 0.9;
            pointer-events: auto;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            outline: none;
        }

        .mic-btn:hover {
            opacity: 1;
            background: rgba(255, 27, 77, 0.1);
            box-shadow: 0 0 15px rgba(255, 27, 77, 0.3);
            transform: scale(1.05);
        }

        .mic-btn.active {
            border-color: var(--secondary);
            color: var(--secondary);
            box-shadow: 0 0 15px rgba(0, 235, 199, 0.3);
        }

        .response-display {
            width: 80%;
            min-height: 4em;
            background: rgba(13, 13, 23, 0.7);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.4;
            color: var(--secondary);
            box-shadow: 0 0 15px rgba(119, 0, 255, 0.2);
            overflow-y: auto;
            max-height: 20vh;
            pointer-events: auto;
            transition: all 0.3s ease;
        }

        .permission-error {
            color: #ff1b4d;
            position: absolute;
            bottom: 20%;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            display: none;
            background: rgba(13, 13, 23, 0.9);
            padding: 0.5rem;
            border-radius: 5px;
            border: 1px solid var(--primary);
            pointer-events: none;
            animation: fadeInOut 5s ease-in-out;
        }

        .system-title {
            position: absolute;
            top: 15%;
            width: 100%;
            text-align: center;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: var(--secondary);
            text-shadow: 0 0 10px rgba(0, 235, 199, 0.5);
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .wake-hint {
            position: absolute;
            top: 25%;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: var(--secondary);
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @keyframes rotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes rotate-reverse {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(-360deg); }
        }

        @keyframes pulse-opacity {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="hologram-container" id="container">
        <div class="interface-panel">
            <div class="system-title">ASTRA AI</div>
            <div class="wake-hint" id="wake-hint">Say "ACTIVATE" to begin</div>
            
            <div class="status-container">
                <div class="status" id="status">SYSTEM STANDBY</div>
            </div>
            
            <div class="hologram-circle circle-1"></div>
            <div class="hologram-circle circle-2"></div>
            <div class="hologram-circle circle-3"></div>
            
            <div class="hologram-core" id="core"></div>
            
            <div class="controls-container">
                <div class="response-display" id="response">Initializing system...</div>
                <button class="mic-btn" id="mic-btn">INITIALIZE SYSTEM</button>
            </div>
            
            <div class="permission-error" id="permission-error">
                Microphone permission denied. Please allow microphone access in your browser settings.
            </div>
        </div>
    </div>

    <!-- Rest of your JavaScript remains the same -->
    <script>
        // Configuration with multiple fallback models
        const HF_API_KEY = "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";
        const MODEL_NAMES = [
            "mistralai/Mistral-7B-Instruct-v0.1",
            "deepseek-ai/deepseek-llm-67b",
            "HuggingFaceH4/zephyr-7b-beta"
        ];
        
        // DOM Elements
        const container = document.getElementById('container');
        const core = document.getElementById('core');
        const responseEl = document.getElementById('response');
        const statusEl = document.getElementById('status');
        const micBtn = document.getElementById('mic-btn');
        const permissionError = document.getElementById('permission-error');
        const wakeHint = document.getElementById('wake-hint');
        
        // Check if speech recognition is available
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            responseEl.textContent = "Speech recognition not supported in your browser";
            micBtn.disabled = true;
            micBtn.textContent = "UNSUPPORTED";
            micBtn.style.opacity = "0.5";
        }
        
        // Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.lang = 'en-US';
        
        // Speech Synthesis
        const synth = window.speechSynthesis;
        
        // State
        let isActive = false;
        const wakeWord = "activate";
        const standbyWord = "deactivate";
        const stopWord = "stop";
        let permissionGranted = false;
        let currentModelIndex = 0;
        let initialized = false;
        
        // Functions
        function updateStatus(text) {
            statusEl.textContent = text;
            
            // Add pulsing animation for active states
            if (text === "LISTENING" || text === "AWAITING COMMAND") {
                statusEl.style.animation = "pulse-opacity 2s infinite";
            } else {
                statusEl.style.animation = "none";
            }
        }
        
        function updateResponse(text) {
            responseEl.textContent = text;
            // Briefly highlight the response
            responseEl.style.borderColor = "var(--secondary)";
            setTimeout(() => {
                responseEl.style.borderColor = "var(--accent)";
            }, 500);
        }
        
        function showPermissionError() {
            permissionError.style.display = 'block';
        }
        
        function speak(text) {
            if (synth.speaking) synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Cortana-like voice settings
            utterance.rate = 1.1;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Try to find a female voice
            const voices = synth.getVoices();
            const preferredVoices = [
                'Microsoft Zira Desktop', // Windows
                'Microsoft Hazel Desktop', // UK
                'Google UK English Female', // Chrome
                'Samantha' // Mac
            ];
            
            for (const voiceName of preferredVoices) {
                const voice = voices.find(v => v.name.includes(voiceName));
                if (voice) {
                    utterance.voice = voice;
                    break;
                }
            }
            
            container.classList.add('voice-active');
            utterance.onend = () => {
                container.classList.remove('voice-active');
                if (isActive) {
                    setTimeout(() => recognition.start(), 500);
                }
            };
            
            synth.speak(utterance);
        }
        
        async function queryAI(prompt) {
            updateStatus("PROCESSING");
            updateResponse("Processing request...");
            
            try {
                const response = await fetch(
                    `https://api-inference.huggingface.co/models/${MODEL_NAMES[currentModelIndex]}`,
                    {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${HF_API_KEY}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            inputs: `<|system|>
You are ASTRA, an advanced AI assistant. Respond concisely and accurately with direct answers only. 
Never tell stories or provide code examples. Be factual and to the point.
Current query: ${prompt}</s>
<|assistant|>`,
                            parameters: {
                                max_new_tokens: 100,
                                temperature: 0.3,
                                top_p: 0.9,
                                repetition_penalty: 1.2,
                                return_full_text: false
                            }
                        })
                    }
                );
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "API error");
                }
                
                const result = await response.json();
                return result[0].generated_text.trim();
            } catch (error) {
                console.error("AI Error:", error);
                // Try next model
                currentModelIndex = (currentModelIndex + 1) % MODEL_NAMES.length;
                if (currentModelIndex === 0) {
                    return "System overload detected. Please try again.";
                }
                return queryAI(prompt); // Retry with next model
            }
        }
        
        function initializeSystem() {
            updateStatus("INITIALIZING");
            updateResponse("Requesting microphone access...");
            
            // Request microphone permission only once
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    stream.getTracks().forEach(track => track.stop());
                    permissionGranted = true;
                    initialized = true;
                    
                    micBtn.textContent = "SYSTEM READY";
                    micBtn.classList.add('active');
                    micBtn.disabled = true;
                    
                    updateStatus("STANDBY");
                    updateResponse("Say 'ACTIVATE' to begin");
                    wakeHint.style.display = 'block';
                    
                    // Start recognition in standby mode
                    recognition.start();
                })
                .catch(error => {
                    console.error("Microphone permission error:", error);
                    showPermissionError();
                    updateStatus("PERMISSION DENIED");
                    updateResponse("Microphone access required");
                    micBtn.textContent = "RETRY MICROPHONE";
                });
        }
        
        // Event Handlers
        recognition.onstart = () => {
            if (!initialized) return;
            
            if (isActive) {
                updateStatus("AWAITING COMMAND");
            } else {
                updateStatus("LISTENING FOR WAKE WORD");
            }
            
            container.classList.add('voice-active');
            core.style.transform = "translate(-50%, -50%) scale(1.1)";
        };
        
        recognition.onend = () => {
            container.classList.remove('voice-active');
            core.style.transform = "translate(-50%, -50%) scale(1)";
            
            if (isActive && initialized) {
                recognition.start(); // Auto-restart when active
            }
        };
        
        recognition.onresult = async (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
            console.log("Detected speech:", transcript);
            
            // Check for stop command first
            if (transcript.includes(stopWord)) {
                synth.cancel();
                updateResponse("Response stopped");
                return;
            }
            
            if (!isActive) {
                if (transcript.includes(wakeWord)) {
                    isActive = true;
                    wakeHint.style.display = 'none';
                    updateResponse("Systems online");
                    speak("Activated. How may I assist?");
                }
            } else {
                if (transcript.includes(standbyWord)) {
                    isActive = false;
                    speak("Deactivating. Goodbye.");
                    updateStatus("STANDBY");
                    updateResponse("Say 'ACTIVATE' to begin");
                    wakeHint.style.display = 'block';
                    return;
                }
                
                const aiResponse = await queryAI(transcript);
                updateResponse(aiResponse);
                speak(aiResponse);
            }
        };
        
        recognition.onerror = (event) => {
            console.error("Speech error:", event.error);
            
            if (event.error === 'not-allowed') {
                showPermissionError();
                updateStatus("PERMISSION DENIED");
                updateResponse("Microphone access required");
                micBtn.textContent = "RETRY MICROPHONE";
                micBtn.classList.remove('active');
                initialized = false;
            } else if (event.error === 'no-speech') {
                if (isActive) {
                    setTimeout(() => recognition.start(), 500);
                }
            } else {
                updateStatus("ERROR: " + event.error);
            }
            
            container.classList.remove('voice-active');
        };
        
        micBtn.addEventListener('click', () => {
            if (!initialized) {
                initializeSystem();
            } else if (!permissionGranted) {
                // Retry if permission was previously denied
                initializeSystem();
            }
        });
        
        // Initialization
        updateStatus("SYSTEM STANDBY");
        updateResponse("Click button to initialize system");
        wakeHint.style.display = 'none';
        
        // Load voices for speech synthesis
        synth.onvoiceschanged = function() {
            console.log("Voices loaded:", synth.getVoices());
        };
        
        // If voices are already loaded
        if (synth.getVoices().length > 0) {
            console.log("Voices already available:", synth.getVoices());
        }
    </script>
</body>
</html>
